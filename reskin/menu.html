<head>
	<!--<link rel="shortcut icon" href="../favicon.ico">
	<link rel="stylesheet" type="text/css" href="css/normalize.css" />-->
	<link rel="stylesheet" type="text/css" href="fonts/font-awesome-4.3.0/css/font-awesome.min.css" />
	<!--<link rel="stylesheet" type="text/css" href="css/demo.css" />-->
	<link rel="stylesheet" type="text/css" href="css/menu.css" />
	<link rel="stylesheet" type="text/css" href="css/dropdown.style4.css" />
	<!-- ICONS -->
	<link rel="stylesheet" type="text/css" href="css/default.css" />
	<link rel="stylesheet" type="text/css" href="css/component.css" />
	<!-- RTC -->
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link href="css/bootstrap.min.css" rel="stylesheet" type="text/css">
    <link href="css/styles.css" rel="stylesheet" type="text/css">
	<!--<script>
		var dd;
	</script>-->
	<!--<script src="js/modernizr.custom.js"></script>-->
	<!-- END ICONS -->
	<!--[if IE]>
		<script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
	<![endif]-->
	<script src="js/TweenMax.min.js"></script>
</head>
<body>
	<svg xmlns="http://www.w3.org/2000/svg" version="1.1" class="filters hidden">
		<defs>
			<filter id="blur" x="-20%" y="0" width="140%" height="100%">
				<feGaussianBlur in="SourceGraphic" stdDeviation="0,0" />
			</filter>
		</defs>
	</svg>
	<div class="container">
		<div class="menu-sm">
			<!-- Coin Select -->
			<select id="cd-dropdown2" class="menu-sm cd-select">
				<option value="-1" selected>Currency type</option>
				<option value="1" class="icon-rbr">RibbitRewards (Livenet)</option>
				<option value="2" class="icon-rbr">RibbitRewards (Testnet)</option>
				<option value="3" class="icon-rbr">Bitcoin</option>
				<option value="4" class="icon-rbr">Liteoin</option>
			</select>
			<!-- /Coin Select -->
			<div class="menu-profile js-blur">
				<ul>
					<li>
						<a href="#" class="menu-item-sm">
							<i class="fa fa-lg fa-user"></i>							
						</a>
					</li>
				</ul>
			</div>
			<div class="menu-sm-bg js-blur"></div>
			<nav class="menu-items">
				<ul>
					<li>
						<a href="#" class="menu-item-sm">
							<i class="fa fa-lg fa-university"></i>							
						</a>
					</li>
					<li>
						<a href="#" class="menu-item-sm">
							<i class="fa fa-lg fa-key"></i>
						</a>
					</li>
					<li>
						<a href="#" class="menu-item-sm">
							<i class="fa-double fa fa-lg fa-weixin"></i>
						</a>
					</li>
					<li>
						<a href="#" class="menu-item-sm">
							<i class="fa fa-lg fa-cogs"></i>
						</a>
					</li>
					<li>
						<a href="#" class="menu-item-sm">
							<i class="fa-double fa fa-lg fa-download"></i>
						</a>
					</li>
				</ul>
			</nav>
		</div>
		<div class="menu">
			<!-- Coin Select -->
			<select id="cd-dropdown" class="menu cd-select">
				<option value="-1" class="icon-finder">Currency type</option>
				<option value="1" class="icon-rbr">RibbitRewards (Livenet)</option>
				<option value="2" class="icon-rbr">RibbitRewards (Testnet)</option>
				<option value="3" class="icon-rbr">Bitcoin</option>
				<option value="4" class="icon-rbr">Liteoin</option>
			</select>
			<!-- /Coin Select -->
			<div class="menu-profile js-blur">
				<ul class="menu-items">
					<li>
						<a href="#" class="menu-item">
							<!--<i class="fa fa-double fa-lg fa-user"></i>-->
							<img height="70px" src="images/profile.png"/>
							<br />
							<span class="js-blur">Profile</span>					
						</a>
					</li>
				</ul>
			</div>
			<div class="menu-bg js-blur"></div>
			<nav class="menu-items">
				<ul>					
					<li>
						<a href="#" class="menu-item">
							<i class="fa fa-lg fa-university"></i>
							<br />
							<span class="js-blur">Wallet</span>
						</a>
					</li>
					<li>
						<a href="#" class="menu-item">
							<i class="fa fa-lg fa-key"></i>
							<br />
							<span class="js-blur">Key Management</span>
						</a>
					</li>
					<li>
						<a href="#" class="menu-item">
							<i class="fa-double fa fa-lg fa-weixin"></i>							
							<i class="fa-double fa fa-lg fa-video-camera"></i>
							<br />
							<span class="js-blur">Chat  /  Video</span>
						</a>
					</li>
					<li>
						<a href="#" class="menu-item">
							<i class="fa fa-lg fa-cogs"></i>
							<br />
							<span class="js-blur">Raw Transactions</span>
						</a>
					</li>
					<li>
						<a href="#" class="menu-item">
							<i class="fa-double fa fa-lg fa-download"></i>
							<i class="fa-double fa fa-lg fa-upload"></i>
							<br />
							<span class="js-blur">Import / Export</span>
						</a>
					</li>
				</ul>
			</nav>
		</div>
		<!--<button class="menu-toggle"><span>Open Menu</span></button>-->
		<a class="menu-toggle js-blur">			
			<i class="fa-double fa fa-lg fa-bars"></i>
		</a>
		<div class="col-md-4"></div>
    	<div class="row col-md-8">

        <!-- =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-= -->
        <!-- MY PHONE NUMBER -->
        <!-- =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-= -->
        <div class="col-sm-6">
            <div id="my-number-section" class="text-center">
                <div id="my-number">LOADING</div>
                <div id="my-number-title" class="hidden-sm hidden-xs">
                    this is <strong>your phone number</strong>
                </div>
                <div id="my-number-permalink">
                    <span class="glyphicon glyphicon-link"></span>
                    call link:
                    <a id="my-number-link" href="...">http://...</a>
                </div>
            </div>
            <div id="pubnub-chat-section" class="text-center">
                <input id="pubnub-chat-input" type="text" placeholder="chat here">
                <div id="pubnub-chat-output"><div></div></div>
            </div>
        </div>

        <!-- =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-= -->
        <!-- Video -->
        <!-- =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-= -->
        <div class="col-sm-6">
            <!-- DISPLAY -->
            <div class="row">
                <div class="col-xs-12 text-center">
                    <div id="video-border">
                        <div class="pubnub-relative">
                            <div id="video-self">...834y8uask</div>
                        </div>
                        <div id="video-display">
                            <span class="glyphicon glyphicon-flash"></span>
                        </div>
                    </div>
                    <div id="pubnub-relative">
                        <div id="video-thumbnail"></div>
                        <div id="pubnub-logo">
                            <div id="pubnub-logo-img"></div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- DIAL CONTROLS -->
            <div class="row">
                <div class="col-sm-6 col-xs-7">
                    <div class="form-group"><div class="input-group">
                    <div class="input-group-addon">
                        <span class="glyphicon glyphicon-th"></span>
                    </div>
                    <input id="number" class="form-control" type="number" placeholder="Type Recipient's #">
                    </div></div>
                </div>
                <div class="col-sm-6 col-xs-5 dial-buttons">
                    <button id="dial" class="btn btn-primary">
                        <span class="glyphicon glyphicon-earphone"></span>
                    </button>
                    <button id="snap" class="btn btn-success">
                        <span class="glyphicon glyphicon-camera"></span>
                    </button>
                    <button id="hangup" class="btn btn-danger">
                        <span class="glyphicon glyphicon-ban-circle"></span>
                    </button>                    
                </div>
            </div>
        </div>
    </div>
</div>
	<!-- /container -->
	<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
	<script src="js/modernizr.custom.63321.js"></script>
	<script src="js/app.js"></script>
	<script type="text/javascript" src="js/jquery.dropdown.js"></script>
	<script type="text/javascript">
		
	</script>
	<script src="js/motionblur.js"></script>
	<script src="js/menu.js"></script>
	<!-- =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=- -->
	<!-- WebRTC Peer Connections -->
	<!-- =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=- -->
	<!--<script src="https://code.jquery.com/jquery-1.11.2.min.js"></script>-->
	<!-- IMPORTANT: THIS IS AN UNMINIFIED DEVELOPMENT PUBNUB LIBRARY 
	    replace this with the latest versioned, minified CDN lib link before 
	    you deploy your app to a production enviornment.
	    https://github.com/pubnub/javascript#cdn-links
	-->
	<script src="https://cdn.pubnub.com/pubnub-dev.js"></script>
	<script src="js/webrtc.js"></script>
	<script src="js/sound.js"></script>
	<script>
		
		var dd;
		$(document).ready((function(){
			
			$( function() {
			
			dd = $( '#cd-dropdown' ).dropdown();

		});
		$( function() {
			
			$( '#cd-dropdown2' ).dropdown();

		});
	
	// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
	// Generate Random Number if Needed
	// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
	var urlargs         = urlparams();
	var my_number       = PUBNUB.$('my-number');
	var my_link         = PUBNUB.$('my-number-link');
	var number          = urlargs.number || Math.floor(Math.random()*999+1);
	
	my_number.number    = number;
	my_number.innerHTML = ''+my_number.number;
	my_link.href        = location.href.split('?')[0] + '?call=' + number;
	my_link.innerHTML   = my_link.href;
	
	// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
	// Update Location if Not Set
	// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
	if (!('number' in urlargs)) {
	    urlargs.number = my_number.number;
	    location.href = urlstring(urlargs);
	    return;
	}
	
	// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
	// Get URL Params
	// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
	function urlparams() {
	    var params = {};
	    if (location.href.indexOf('?') < 0) return params;
	
	    PUBNUB.each(
	        location.href.split('?')[1].split('&'),
	        function(data) { var d = data.split('='); params[d[0]] = d[1]; }
	    );
	
	    return params;
	}
	
	// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
	// Construct URL Param String
	// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
	function urlstring(params) {
	    return location.href.split('?')[0] + '?' + PUBNUB.map(
	        params, function( key, val) { return key + '=' + val }
	    ).join('&');
	}
	
	// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
	// Calling & Answering Service
	// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
	var video_out = PUBNUB.$('video-display');
	var img_out   = PUBNUB.$('video-thumbnail');
	var img_self  = PUBNUB.$('video-self');
	
	var phone     = window.phone = PHONE({
	    number        : my_number.number, // listen on this line
	    publish_key   : 'pub-c-561a7378-fa06-4c50-a331-5c0056d0163c',
	    subscribe_key : 'sub-c-17b7db8a-3915-11e4-9868-02ee2ddab7fe',
	    ssl           : true
	});
	
	// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
	// Video Session Connected
	// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
	function connected(session) {
	    video_out.innerHTML = '';
	    video_out.appendChild(session.video);
	
	    PUBNUB.$('number').value = ''+session.number;
	    sounds.play('sound/hi');
	    console.log("Hi!");
	}
	
	// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
	// Video Session Ended
	// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
	function ended(session) {
	    set_icon('facetime-video');
	    img_out.innerHTML = '';
	    sounds.play('sound/goodbye');
	    console.log("Bye!");
	}
	
	// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
	// Video Session Ended
	// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
	function set_icon(icon) {
	    video_out.innerHTML = '<span class="glyphicon glyphicon-' +
	        icon + '"></span>';
	}
	
	// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
	// Request fresh TURN servers from XirSys
	// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
	function get_xirsys_servers() {
	    var servers;
	    $.ajax({
	        type: 'POST',
	        url: 'https://api.xirsys.com/getIceServers',
	        data: {
	            room: 'default',
	            application: 'default',
	            domain: 'www.pubnub-example.com',
	            ident: 'pubnub',
	            secret: 'dec77661-9b0e-4b19-90d7-3bc3877e64ce',
	        },
	        success: function(res) {
	            res = JSON.parse(res);
	            if (!res.e) servers = res.d.iceServers;
	        },
	        async: false
	    });
	    return servers;
	}
	
	// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
	// Start Phone Call
	// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
	function dial(number) {
	    // Dial Number
	    var session = phone.dial(number, get_xirsys_servers());
	
	    // No Dupelicate Dialing Allowed
	    if (!session) return;
	
	    // Show Connecting Status
	    set_icon('send');
	}
	
	// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
	// Ready to Send or Receive Calls
	// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
	phone.ready(function(){
	    // Ready To Call
	    set_icon('facetime-video');
	
	    // Auto Call
	    if ('call' in urlargs) {
	        var number = urlargs['call'];
	        PUBNUB.$('number').value = number;
	        dial(number);
	    }
	
	    // Make a Phone Call
	    PUBNUB.bind( 'mousedown,touchstart', PUBNUB.$('dial'), function(){
	        var number = PUBNUB.$('number').value;
	        if (!number) return;
	        dial(number);
	    } );
	
	    // Hanup Call
	    PUBNUB.bind( 'mousedown,touchstart', PUBNUB.$('hangup'), function() {
	        phone.hangup();
	        set_icon('facetime-video');
	    } );
	
	    // Take Picture
	    PUBNUB.bind( 'mousedown,touchstart', PUBNUB.$('snap'), function() {
	        var photo = phone.snap();
	        img_self.innerHTML = ' ';
	        img_self.appendChild(photo.image);
	        setTimeout( function() { img_self.innerHTML = ' ' }, 750 );
	    } );
	});
	
	// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
	// Received Call Thumbnail
	// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
	function thumbnail(session) {
	    img_out.innerHTML = '';
	    img_out.appendChild(session.image);
	    img_out.appendChild(phone.snap().image);
	}
	
	// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
	// Receiver for Calls
	// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
	phone.receive(function(session){
	    session.message(message);
	    session.thumbnail(thumbnail);
	    session.connected(connected);
	    session.ended(ended);
	});
	
	// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
	// Chat
	// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
	var chat_in  = PUBNUB.$('pubnub-chat-input');
	var chat_out = PUBNUB.$('pubnub-chat-output');
	
	// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
	// Send Chat MSG and update UI for Sending Messages
	// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
	PUBNUB.bind( 'keydown', chat_in, function(e) {
	    if ((e.keyCode || e.charCode) !== 13)     return true;
	    if (!chat_in.value.replace( /\s+/g, '' )) return true;
	
	    phone.send({ text : chat_in.value });
	    add_chat( my_number.number + " (Me)", chat_in.value );
	    chat_in.value = '';
	} )
	
	// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
	// Update Local GUI
	// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
	function add_chat( number, text ) {
	    if (!text.replace( /\s+/g, '' )) return true;
	
	    var newchat       = document.createElement('div');
	    newchat.innerHTML = PUBNUB.supplant(
	        '<strong>{number}: </strong> {message}', {
	        message : safetxt(text),
	        number  : safetxt(number)
	    } );
	    chat_out.insertBefore( newchat, chat_out.firstChild );
	}
	
	// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
	// WebRTC Message Callback
	// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
	function message( session, message ) {
	    add_chat( session.number, message.text );
	}
	
	// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
	// XSS Prevent
	// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
	function safetxt(text) {
	    return (''+text).replace( /[<>]/g, '' );
	}
	
	// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
	// Problem Occured During Init
	// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
	phone.unable(function(details){
	    console.log("Alert! - Reload Page.");
	    console.log(details);
	    set_icon('remove');
	});
	
	// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
	// Debug Output
	// -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
	phone.debug(function(details){
	     // console.log(details);
	});
	
	})());
</script>
</body>